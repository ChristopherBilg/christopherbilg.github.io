<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Christopher Bilger's Portfolio" />
    <meta name="keywords" content="Resume, Portfolio, Personal, Blog" />
    <meta name="author" content="Christopher Bilger" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />

    <title>Victoria Bilger | Love Letters</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
    <link rel="stylesheet" media="screen" href="../css/mvp.css" />
    <link rel="stylesheet" media="screen" href="../css/styles.css" />
  </head>

  <body>
    <noscript id="full-screen-noscript-message"> Please enable JavaScript in order to view this webpage. </noscript>

    <div id="yellow-banner">WORK IN PROGRESS</div>

    <header>
      <div class="typewriter">
        <h1>Victoria Bilger | Love Letters</h1>
      </div>
    </header>

    <main></main>

    <footer>
      <hr />

      <section>
        <h3>Love letters written to my wife, Victoria Bilger. For her eyes only.</h3>
      </section>
    </footer>

    <script type="text/javascript" src="../js/crypto-js-4.1.1.min.js"></script>
    <script type="module">
      import * as Arlo from "../js/arlo/index.js";

      for (const exportedName in Arlo) {
        window[exportedName] = Arlo[exportedName];
      }

      (() => {
        class App extends StyledComponent {
          init() {
            this.ciphertext =
              "U2FsdGVkX19iofJ3ybPRiv9Z/hwFEiUnMJVu3pVHp1TRTyrjKoAq5EZQBcO5I4RV0KB9JDmdueAJLfsREtor9UdLgJtHKqsDVL+ndQU+MHYgKNmiSyTYO7Je+Ilgu7V3t+Xja1lC7oYPmjZLcAHKNOuRCn+Bbl/oeMdo51nKj1+VBoWDXS9vmBC3TwroGUWxyjOA799kH/wQBaHWQGBvILdE7StEac4mKqBn7LwbGOqTdOglboCuqm/nPkQ3y7Wwewwdl3hFWGiu//nINNPnB4tJeiHIGIVNkMG1cf5VXPoHXByMueEnNYytkuUmmkz2K2xEsPIrbHAJtG7+8urEizbV2EbCBites5OBlA5k3+0Qlk8+b4BDG1BJ4QJV4bmvT6HCzNqxu5cnL0CAD34MlyqoOK2NAaT8qNuBFYjxecIv7vBMd6BAfCfdeYOBB8KoohTsV8p9KFxiGMiuJIGvDw==";

            this.loveLetters = [];

            this.password = prompt("Please enter password:") || "";

            // console.log(CryptoJS.AES.encrypt(JSON.stringify(this.loveLetters), this.password).toString());

            this.error = false;
            try {
              this.loveLetters = JSON.parse(CryptoJS.AES.decrypt(this.ciphertext, this.password).toString(CryptoJS.enc.Utf8));
              // console.log(this.loveLetters);
            } catch (e) {
              this.error = true;
            }
          }

          decrypt() {}

          styles() {
            return css`
              section {
                margin-bottom: 2rem;

                p.date {
                  font-weight: bold;
                }
              }
            `;
          }

          compose() {
            return vdom`
              <div>
                ${this.loveLetters
                  .sort((a, b) => (a.publishDate < b.publishDate ? 1 : -1))
                  .map(
                    (letter) => vdom`
                      <section>
                        <hr id="${letter.publishDate}" />
                        <h2><a href="#${letter.publishDate}">${letter.title}</a></h2>
                        <hr />

                        <p class="date">${letter.prettyDate}</p>

                        ${letter.body.map((paragraph) => vdom`<p>${paragraph}</p>`)}
                      </section>
                    `
                  )}
                ${
                  this.error
                    ? vdom`
                      <section>
                        <h2>Incorrect password. Nothing to see here.</h2>
                      </section>
                    `
                    : ""
                }
              </div>
            `;
          }
        }

        const app = new App();
        document.getElementsByTagName("main")[0].appendChild(app.node);
      })();
    </script>
  </body>
</html>
