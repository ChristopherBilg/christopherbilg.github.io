<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Christopher Bilger's Portfolio">
    <meta name="keywords" content="Resume, Portfolio, Personal, Blog">
    <meta name="author" content="Christopher Bilger">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Side Notes (Note-Taking Web App)</title>
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="stylesheet" media="screen" href="../../css/mvp.css">
    <link rel="stylesheet" media="screen" href="../../css/styles.css">
</head>

<body>
    <noscript id="full-screen-noscript-message">
        Please enable JavaScript in order to use the password generator.
    </noscript>

    <main hidden>
        <a href="/projects">Back to Projects List</a>

        <h1>Side Notes (Note-Taking Web App)</h1>

        <p>
            <b>Side Notes</b> is a minimal, light-weight, todo-style note keeping web application. This web application
            keeps all data stored in the browser's internal database, meaning that all side-notes reside only on this
            browser. Absolutely no data is ever sent away from your local browser.
        </p>

        <input type="submit" onclick="return createSideNote();" value="Create Side Note [+]" />

        <div id="side-notes-container"></div>
    </main>

    <script>
        document.getElementsByTagName('main')[0].hidden = false;
        const sideNotesContainer = document.getElementById('side-notes-container');

        const loadAllSideNotesFromLocalStorage = () => {
            return JSON.parse(localStorage.getItem('sideNotes'));
        };

        let allSideNotes = loadAllSideNotesFromLocalStorage() || [];
        const SIDE_NOTE_TEMPLATE = {
            data: '',
        };

        const saveAllSideNotesToLocalStorage = () => {
            const stringified = JSON.stringify(allSideNotes);
            const sideNotes = localStorage.setItem('sideNotes', stringified);
        };
        saveAllSideNotesToLocalStorage();

        const getCustomLineCountFromString = s => {
            return s.split(/\r|\r\n|\n/).length < 2 ? 2 : s.split(/\r|\r\n|\n/).length;
        };

        const updateTextArea = index => {
            const textArea = sideNotesContainer.getElementsByTagName('aside')[index].getElementsByTagName('textarea')[0];
            allSideNotes[index].data = textArea.value;

            textArea.style.height = `${getCustomLineCountFromString(textArea.value)}rem`;

            saveAllSideNotesToLocalStorage();
            return false;
        };

        const rerenderSideNotes = () => {
            const allSideNotesHTMLElements = [];
            allSideNotes.forEach((note, index) => {
                const aside = document.createElement('aside');

                const header = document.createElement('p');
                header.style.fontWeight = 'bold';
                header.innerHTML = `Side Note #${index}`;
                aside.appendChild(header);

                const deleteButton = document.createElement('input');
                deleteButton.type = 'submit';
                deleteButton.onclick = () => deleteSideNote(index);
                deleteButton.value = '[-]';
                aside.appendChild(deleteButton);

                const dataTextArea = document.createElement('textarea');
                dataTextArea.style.width = '80%';
                dataTextArea.style.height = `${getCustomLineCountFromString(note.data)}rem`;
                dataTextArea.style.resize = 'none';
                dataTextArea.style.overflow = 'hidden';
                dataTextArea.oninput = () => updateTextArea(index);
                dataTextArea.value = allSideNotes[index].data;
                aside.appendChild(dataTextArea);

                allSideNotesHTMLElements.push(aside);
            });

            sideNotesContainer.innerHTML = '';
            allSideNotesHTMLElements.forEach(e => sideNotesContainer.appendChild(e));
        };
        rerenderSideNotes();

        const createSideNote = () => {
            allSideNotes.push(JSON.parse(JSON.stringify(SIDE_NOTE_TEMPLATE)));
            rerenderSideNotes();

            saveAllSideNotesToLocalStorage();
            return false;
        };

        const deleteSideNote = index => {
            allSideNotes = allSideNotes.filter((_, i) => i != index);
            rerenderSideNotes();

            saveAllSideNotesToLocalStorage();
            return false;
        };
    </script>
</body>

</html>