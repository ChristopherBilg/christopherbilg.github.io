<!DOCTYPE html>
<html lang="en" color-mode="user">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Christopher Bilger's Portfolio" />
    <meta name="keywords" content="Resume, Portfolio, Personal, Projects, Presentations" />
    <meta name="author" content="Christopher Bilger" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Procedural Generation (Vibe Coded)</title>
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico" />
    <link rel="stylesheet" media="screen" href="../../css/mvp.css" />
    <link rel="stylesheet" media="screen" href="../../css/styles.css" />
  </head>

  <body>
    <noscript id="full-screen-noscript-message">Please enable JavaScript in order to view this webpage.</noscript>

    <main hidden>
      <a href="/projects">Back to Projects List</a>

      <h1>Procedural Generation (Vibe Coded)</h1>

      <p>
        A simple procedural generation engine demonstrating terrain generation using Perlin-like noise. The terrain is
        generated algorithmically using mathematical functions rather than manually designed data.
      </p>
    </main>

    <script type="module">
      import * as Arlo from "../../js/arlo/index.js";
      import { TerrainApp } from "./terrain-app.js";

      // Expose Arlo to global scope for component usage
      for (const exportedName in Arlo) {
        window[exportedName] = Arlo[exportedName];
      }

      // Initialize application
      (() => {
        document.getElementsByTagName("main")[0].hidden = false;

        // Check for shared config in URL
        const urlParams = new URLSearchParams(window.location.search);
        const configParam = urlParams.get("config");
        let initialConfig = {
          width: 600,
          height: 400,
          scale: 0.015,
          octaves: 5,
          persistence: 0.5,
        };

        if (configParam) {
          try {
            const decodedConfig = JSON.parse(atob(configParam));
            initialConfig = { ...initialConfig, ...decodedConfig };
          } catch (e) {
            console.error("Failed to parse shared config:", e);
          }
        }

        // Create terrain application
        const terrainApp = new TerrainApp(Component, vdom, initialConfig);

        // Create and mount Arlo component
        const component = terrainApp.createComponent();
        document.getElementsByTagName("main")[0].appendChild(component.node);

        // Apply shared config if present
        if (configParam) {
          try {
            const decodedConfig = JSON.parse(atob(configParam));
            setTimeout(() => {
              // Apply all config values using the component's method
              component._applyImportedConfigData(decodedConfig);
            }, 100);
          } catch (e) {
            // If shared config fails, just generate normally
            console.error("Failed to apply shared config from URL:", e);
            setTimeout(() => {
              component.regenerate();
            }, 100);
          }
        } else {
          // Generate initial terrain
          setTimeout(() => {
            component.regenerate();
          }, 100);
        }
      })();
    </script>
  </body>
</html>
