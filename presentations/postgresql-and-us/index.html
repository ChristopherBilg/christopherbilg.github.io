<!DOCTYPE html>
<html lang="en" color-mode="user">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Christopher Bilger's Portfolio" />
    <meta name="keywords" content="Resume, Portfolio, Personal, Projects" />
    <meta name="author" content="Christopher Bilger" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta property="og:url" content="https://chrisbilger.com" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Chris Bilger's Portfolio" />
    <meta property="og:description" content="Christopher Bilger's Portfolio" />
    <meta property="og:image" content="https://chrisbilger.com/images/portfolio.avif" />

    <title>PostgreSQL and Us</title>
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico" />

    <link rel="stylesheet" href="./reveal.js-5.1.0/reset.css" />
    <link rel="stylesheet" href="./reveal.js-5.1.0/reveal.css" />
    <link rel="stylesheet" href="./reveal.js-5.1.0/theme/solarized.css" />

    <link rel="stylesheet" href="./highlight.js-11.9.0/default.min.css" />
    <script src="./highlight.js-11.9.0/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>

    <style>
      .reveal {
        & .slides {
          & section {
            & h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
              text-transform: none;
            }

            & ul {
              font-size: 75%;
            }

            & p {
              font-size: 75%;
            }

            & table {
              font-size: 65%;
            }
          }
        }
      }

      .blue {
        color: #268bd2;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h2>PostgreSQL and Us</h2>
          <h4>How We Use PostgreSQL, What Works, and What's Next</h4>

          <br />
          <br />

          <p>Christopher R. Bilger</p>
          <p>March 11th, 2025</p>
        </section>

        <section>
          <h2>Agenda</h2>

          <br />
          <br />

          <div style="display: grid; grid-template-columns: 1fr 1fr">
            <div style="align-self: center">
              <ul>
                <li>How We Use PostgreSQL</li>
                <li>Pros and Cons of Our Current Approach</li>
                <li>Best Practices</li>
                <li>Recommended Next Steps</li>
                <li>Conclusion + Q&A</li>
              </ul>
            </div>

            <div>
              <img data-src="./images/Postgresql_elephant.png" width="200" />
            </div>
          </div>
        </section>

        <section>
          <section>
            <h2>How We Use PostgreSQL</h2>

            <br />
            <br />

            <h4>
              Note: This presentation revolves around our <span class="blue">main product database</span>; however 90%+
              is true for all of our PostgreSQL databases.
            </h4>
          </section>

          <section>
            <h2>Overview of Our Database Infrastructure</h2>

            <br />
            <br />

            <ul>
              <li>Managed PostgreSQL service via AWS RDS (Relational Database Service)</li>
              <li>
                Single instance primary with a failover read replica
                <ul>
                  <li>Subject to change once we have an RDS Proxy in place</li>
                </ul>
              </li>
              <li>
                Database migrations handled via the talkiatry-app Git repository
                <ul>
                  <li>Applied using the <span class="blue">knex</span> NPM package</li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <h2>Key Applications and Workloads</h2>

            <br />
            <br />

            <ul>
              <li>Source of truth for all pre-patient (a.k.a. intake) data</li>
              <li>Supports all <span class="blue">CRUD operations</span> from the intake assessment and Synapse</li>
              <li>Interfaces directly with all running <span class="blue">cronjobs</span> (Argo Workflows)</li>
              <li>Used for reporting and analytics via regular sync's to Snowflake</li>
              <li>
                Also regularly sync's new data from external sources
                <ul>
                  <li>Snowflake</li>
                  <li>eCW</li>
                  <li>Sohar</li>
                  <li>etc.</li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <h2>Scale and Performance Considerations</h2>

            <p>
              Using PostgreSQL's native functions, we can easily find our database's size when stored on disk. This
              includes indices and other relations which increase disk space beyond that of the data itself.
            </p>

            <br />

            <pre>
              <code class="language-sql">
SELECT pg_size_pretty(pg_database_size('&lt;dbname&gt;'));
              </code>
            </pre>
          </section>

          <section>
            <h2>Scale and Performance Considerations</h2>

            <p>
              As of today, our current size on disk is <span class="blue">~62 GB</span>. This includes all data,
              indices, and other relations.
            </p>

            <br />

            <table>
              <tr>
                <th>Size Category</th>
                <th>Range</th>
              </tr>
              <tr>
                <td>Very Small</td>
                <td>&lt;1 GB</td>
              </tr>
              <tr>
                <td>Small</td>
                <td>1 GB - 100 GB</td>
              </tr>
              <tr>
                <td>Medium</td>
                <td>100 GB - 1 TB</td>
              </tr>
              <tr>
                <td>Large</td>
                <td>1 TB - 10 TB</td>
              </tr>
              <tr>
                <td>Very Large</td>
                <td>&gt;10 TB</td>
              </tr>
            </table>
          </section>
        </section>

        <section>
          <section>
            <h2>Pros of Our Current Approach</h2>

            <br />
            <br />

            <ul>
              <li>Managed service with minimal maintenance</li>
              <li>Easy to <span class="blue">scale up and out</span></li>
              <li>
                Highly reliable and secure
                <ul>
                  <li>Regularly patched and updated by AWS</li>
                  <li>Automated backups and point-in-time recovery</li>
                </ul>
              </li>
              <li>Compatible with a wide range of tools and libraries</li>
              <li>
                Excellent support for complex queries and data types
                <ul>
                  <li>JSONB, arrays, and custom types</li>
                  <li>We recently added PostGIS support for geospatial data</li>
                </ul>
              </li>
            </ul>
          </section>

          <!--
            TODO ???:
            - Strengths in our setup
            - Features that work well for us
            - Performance, scalability, reliability wins
            - Security and compliance benefits
          -->

          <section>
            <img data-src="./images/kiss.png" />
          </section>
        </section>

        <section>
          <section>
            <h2>Cons & Challenges</h2>

            <br />
            <br />

            <ul>
              <li>Performance bottlenecks</li>
              <li>Operational pain points</li>
              <li>Lessons learned from past experiences</li>
            </ul>
          </section>

          <section>
            <h2>Performance Bottlenecks</h2>

            <br />
            <br />

            <ul>
              <li>Slow queries and high CPU usage</li>
              <li>Indexing and query optimization challenges</li>
              <li>Resource contention and connection limits</li>
            </ul>
          </section>

          <section>
            <h2>Operational Pain Points</h2>

            <br />
            <br />

            <ul>
              <li>Database migrations and schema changes</li>
              <li>Monitoring and alerting practices</li>
            </ul>
          </section>

          <section>
            <h2>Lessons Learned from Past Experiences</h2>

            <br />
            <br />

            <ul>
              <li>Reduce long-running transactions</li>
              <li>Optimize queries and indices</li>
              <li>Regularly review and update our database schema</li>
            </ul>
          </section>

          <section>
            <img data-src="./images/this-is-fine-fire.jpg" />
          </section>
        </section>

        <section>
          <section>
            <h2>Best Practices We Follow</h2>
          </section>

          <section>
            <img data-src="./images/with_connection_pool.png" />
          </section>

          <!--
            TODO:
            - Backup and Recovery strategies
            - Monitoring and alerting practices
            - Indexing and query optimizations
            - Connection pooling and resource management
            - CODE SNIPPET: Example of a well-optimized query user proper indexing
          -->
        </section>

        <section>
          <section>
            <h2>Best Practices We Should Adopt</h2>
          </section>

          <section>
            <img data-src="./images/pganalyze_query_performance_date_picker.png" />
          </section>

          <!--
            TODO:
            - Areas for improvement
            - Industry-standard recommendations
            - New features, tools, and/or techniques to consider
            - CODE SNIPPET: Example of a poorly-optimized query that could be improved or using PG's EXPLAIN ANALYZE feature
          -->
        </section>

        <section>
          <h2>Recommended Next Steps</h2>

          <!--
            TODO:
            - Actionable items for improvement
            - Proposed updates or migrations
            - Training, monitoring, or tooling recommendations for enhancing our practice
          -->
        </section>

        <!--
          Ideas:
          - How We Use PostgreSQL, What Works, and What's Next
          - Our practices and how to enhance them
          - Database indices / optimizations for easy wins
          - Performance metric monitoring and tooling
          - RDS Proxy
        -->

        <section>
          <section>
            <h2>Conclusion + Q&A</h2>

            <br />
            <br />

            <div style="display: grid; grid-template-columns: 1fr 1fr">
              <div style="align-self: center">
                <ul>
                  <li>How We Use PostgreSQL</li>
                  <li>Pros and Cons of Our Current Approach</li>
                  <li>Best Practices</li>
                  <li>Recommended Next Steps</li>
                  <li>Q&A</li>
                </ul>
              </div>

              <div>
                <img data-src="./images/keep-calm-and-use-postgres.webp" width="400" />
              </div>
            </div>
          </section>

          <section>
            <h2>Poweblue By</h2>

            <br />
            <br />

            <ol>
              <li>A single, static webpage.</li>
              <li><a href="https://revealjs.com/" target="_blank">reveal.js</a></li>
              <li><a href="https://highlightjs.org/" target="_blank">highlight.js</a></li>
            </ol>
          </section>

          <!--
            TODO:
            - Replace list with a summary of key takeaways + relativistic score for us
          -->
        </section>
      </div>
    </div>

    <script>
      hljs.highlightAll();
    </script>

    <script type="module">
      import Reveal from "./reveal.js-5.1.0/reveal.esm.js";

      let deck = new Reveal({
        slideNumber: "c/t",
        help: true,
      });
      deck.initialize();
    </script>
  </body>
</html>
